<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Products Portal</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', path='/style.css') }}" rel="stylesheet">
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
    <h2 style="color:antiquewhite">Product page</h2>

    <div class="ms-auto">
        {% if user_id %}
             <button type="button" class="logout-btn"> <a href="/logout" style="text-decoration: none; color: wheat;">Logout </a></button>
        {% else %}
            <div class="login" >  <a href="/login" style="text-decoration: none; color: azure;"> <button class="logout-btn"> Login </button> </a>  </div>
        {% endif %}
    </div>
</nav>

{% if success %}
<div class="alert alert-success text-center my-3">
    {{ success }}
</div>
{% endif %}

{% if error %}
<div class="alert alert-danger text-center my-3">
    {{ error }}
</div>
{% endif %}


<div class="d-flex justify-content-center my-4">
        <button class="fancy-btn" onclick="showProducts()">All Products</button>
    </div>

{% if products %}
<div id="productSection" class="container mb-5" style="display:none;">
    <div class="row g-4 justify-content-center">

        {% for product in products %}
        <div class="col-sm-6 col-md-4 col-lg-3">

            <div class="card h-100 shadow-sm">
                <img src="/{{ product.image }}" class="card-img-top" alt="product">

                <div class="card-body">
                    <h6 class="fw-bold">{{ product.title }}</h6>
                    <p class="text-muted small">{{ product.description }}</p>

                    <div class="d-flex align-items-center gap-2">
                        <span class="text-decoration-line-through text-muted">
                            â‚¹{{ product.price }}
                        </span>
                        <span class="fw-bold text-success">
                            â‚¹{{ product.price - ((product.price * product.discount) / 100) }}
                        </span>
                        <span class="badge bg-danger ms-auto">
                            {{ product.discount }}% OFF
                        </span>
                    </div>
                </div>

                <div class="card-footer bg-white border-0">
                    <button class="btn btn-dark w-100 order-btn"
                            data-product-id="{{ product.p_id }}">
                        ðŸ›’ Order Now
                    </button>
                    <div class="inputContainer mt-2"></div>
                </div>
            </div>

        </div>
        {% endfor %}

    </div>
</div>
{% endif %}

<div class="d-flex justify-content-center my-5 gap-3">
        <a class="fancy" href="/addproduct">
            <span class="top-key"></span>
            <span class="text">Add product</span>
            <span class="bottom-key-1"></span>
            <span class="bottom-key-2"></span>
        </a>
        <a class="fancy" href="/updatediscount">
            <span class="top-key"></span>
            <span class="text">Update discount</span>
            <span class="bottom-key-1"></span>
            <span class="bottom-key-2"></span>
        </a>
        {% if user_id %}
        <a class="fancy" href="/products/get-orders/{{ user_id }}">
            <span class="top-key"></span>
            <span class="text">Go to Dashboard</span>
            <span class="bottom-key-1"></span>
            <span class="bottom-key-2"></span>
        </a>
        {% else %}
        <a class="fancy" href="/login">
            <span class="text">Go to Dashboard</span>
        </a>
        {% endif %}
    </div>


<script>
    function showProducts() {
        document.getElementById("productSection").style.display = "block";
    }

    document.querySelectorAll(".order-btn").forEach(btn => {
        btn.addEventListener("click", function () {
            const productId = this.dataset.productId;
            const container = this.closest(".card")
                .querySelector(".inputContainer");

            container.innerHTML = `
                <form method="POST" action="/order" class="mt-2">
                    <input type="hidden" name="product_id" value="${productId}">
                    <input type="number"
                           name="quantity"
                           class="form-control mb-2"
                           placeholder="Quantity"
                           required>
                    <button type="submit" class="btn btn-success w-100">
                        Confirm Order
                    </button>
                </form>
            `;
        });
    });
</script>

</body>
</html>
